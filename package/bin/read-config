#! /usr/bin/env node

filename = process.env.file || "config.json"
target = process.env.target || "default";

function print_export(key, value) {
  console.log(key + "=" + JSON.stringify(value) + "; export " + key);
};

try {
  readFileSync = require("fs").readFileSync;
  config = JSON.parse(readFileSync(filename));
  env = config.package[target];
  env.name = config.name;
} catch (exn) {
  console.error("Error: failed to load config.json")
  console.error(exn.stack);
  process.exit(23);
};
Object.keys(env)
  .filter(function (key) {
    return typeof env[key] === "string";
  })
  .filter(function (key) {
    return /^[A-Za-z]+$/.test(key);
  })
  .forEach(function (key) {
    print_export(key, env[key]);
  });
